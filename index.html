<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Radio</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        :root {
            --bg-color: #000000;
            --text-color: #ffffff;
            --accent-color: #0078d7; 
            --disabled-color: #444;
            --fav-color: #ffca28;
            --error-color: #ff4d4d;
        }

        @property --wipe-angle {
          syntax: '<angle>';
          initial-value: 0deg;
          inherits: false;
        }

        html, body {
            position: fixed;
            overflow: hidden;
            width: 100%; height: 100%;
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: "Segoe UI", "Segoe UI Semibold", Tahoma, sans-serif;
            -webkit-tap-highlight-color: transparent;
            touch-action: none; 
        }

        header {
            position: absolute;
            top: 0; width: 100%; z-index: 1000;
            background-color: rgba(0,0,0,0.85);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            padding-top: calc(env(safe-area-inset-top) + 15px); 
            padding-bottom: 12px;
            touch-action: pan-y;
        }

        .header-inner {
            max-width: 1600px; margin: 0 auto;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 30px; box-sizing: border-box;
        }

        h1 { font-weight: 200; font-size: 2.4rem; margin: 0; letter-spacing: -1px; cursor: pointer; user-select: none; }

        .controls { display: flex; gap: 8px; }

        .control-btn {
            position: relative;
            background: none; border: 1.5px solid rgba(255,255,255,0.2);
            border-radius: 50%; width: 40px; height: 40px;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: all 0.2s ease; color: white; font-size: 0.9rem; font-weight: 600;
            overflow: hidden;
        }

        .control-btn.active { background-color: var(--accent-color); border-color: var(--accent-color); }

        #timer-btn.active {
            background: conic-gradient(transparent var(--wipe-angle), var(--accent-color) 0deg);
            border-color: var(--accent-color);
            animation: wipeClockwise 60s linear infinite;
        }

        @keyframes wipeClockwise { from { --wipe-angle: 0deg; } to { --wipe-angle: 360deg; } }

        .control-btn:hover:not(:disabled) { border-color: white; background-color: rgba(255,255,255,0.1); }
        .control-btn.active:hover { background-color: #0086f0; }
        .control-btn:disabled { border-color: var(--disabled-color); cursor: not-allowed; }
        .control-btn svg { fill: white; width: 16px; height: 16px; display: block; }

        #scroll-container {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            overflow-y: auto; -webkit-overflow-scrolling: touch;
            padding-top: calc(95px + env(safe-area-inset-top)); 
            padding-bottom: env(safe-area-inset-bottom);
            touch-action: pan-y;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(175px, 1fr));
            gap: 15px; max-width: 1600px; margin: 0 auto;
            padding: 10px 30px 20px 30px; box-sizing: border-box;
        }

        @media (max-width: 600px) {
            .grid { grid-template-columns: repeat(2, 1fr); padding: 10px 15px 20px 15px; gap: 10px; }
            .header-inner { padding: 0 15px; }
            h1 { font-size: 2rem; }
            #scroll-container { padding-top: calc(85px + env(safe-area-inset-top)); }
        }

        .tile {
            aspect-ratio: 1 / 1; position: relative;
            padding: 15px; cursor: pointer;
            transition: transform 0.2s ease, filter 0.2s ease;
            overflow: hidden;
        }

        .tile::after {
            content: ''; position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(circle at bottom right, rgba(0,0,0,0.35) 0%, transparent 65%);
            pointer-events: none; z-index: 1;
        }

        .tile:hover { filter: brightness(1.2); }
        .tile.active { outline: 4px solid white; outline-offset: -4px; }

        .fav-star {
            position: absolute; top: 20px; left: 15px;
            font-size: 1.2rem; line-height: 1;
            color: rgba(255, 255, 255, 0.3); transition: all 0.2s ease; z-index: 10;
        }

        .tile.is-fav .fav-star { color: var(--fav-color); }

        .status-container {
            position: absolute; top: 19px; right: 15px;
            z-index: 3; display: flex;
            justify-content: flex-end; align-items: flex-start;
        }

        .spinner {
            display: none; width: 18px; height: 18px;
            border: 2px solid rgba(255,255,255,0.2);
            border-top-color: white; border-radius: 50%;
            animation: spin 0.8s linear infinite; pointer-events: none;
            margin-top: 3px; margin-right: 3px; /* Centers relative to 24px icon space */
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .tile.buffering .spinner { display: block; }

        /* SLEEK ERROR ICON */
        .error-icon {
            display: none; width: 24px; height: 24px;
            fill: var(--error-color); pointer-events: none;
        }
        .tile.error .error-icon { display: block; }

        .tile-play-icon { width: 24px; height: 24px; fill: white; display: none; pointer-events: none; }
        .tile.ready .tile-play-icon { display: block; }
        .tile.buffering .tile-play-icon, .tile.error .tile-play-icon { display: none; }

        .eq-container {
            display: none; align-items: flex-end; gap: 1.5px;
            height: 12px; width: 20px;
            pointer-events: none; margin-top: 4px;
        }
        .tile.active .eq-container { display: flex; }
        .tile.buffering .eq-container, .tile.error .eq-container { display: none; }

        .eq-bar { background-color: white; width: 3px; border-radius: 1px; height: 30%; }
        .tile.active .eq-bar { animation: rollingWave 0.8s ease-in-out infinite; }
        .tile.active .eq-bar:nth-child(1) { animation-delay: 0.0s; }
        .tile.active .eq-bar:nth-child(2) { animation-delay: 0.1s; }
        .tile.active .eq-bar:nth-child(3) { animation-delay: 0.2s; }
        .tile.active .eq-bar:nth-child(4) { animation-delay: 0.3s; }

        @keyframes rollingWave { 0%, 100% { height: 30%; } 50% { height: 100%; } }

        .tile-name {
            position: absolute; bottom: 15px; left: 15px;
            font-size: 1.4rem; font-weight: 600; z-index: 2;
            letter-spacing: -0.5px; line-height: 1; text-transform: uppercase;
            pointer-events: none; max-width: calc(100% - 75px);
        }

        .geo-tag {
            position: absolute; bottom: 15px; right: 15px;
            z-index: 2; text-align: right; display: flex;
            align-items: center; gap: 4px; line-height: 1;
        }

        .geo-text { font-size: 0.8rem; font-weight: 400; opacity: 0.9; }
        .geo-flag { font-size: 1.3rem; display: inline-block; }

        .c1 { background-color: #00A300; } .c2 { background-color: #2D89EF; } 
        .c3 { background-color: #9F00A7; } .c4 { background-color: #603CBA; } 
        .c5 { background-color: #DA532C; } .c6 { background-color: #B91D47; } 
        .c7 { background-color: #00ABA9; } .c8 { background-color: #7E3878; } 

    </style>
</head>
<body>

    <header>
        <div class="header-inner">
            <h1 id="app-title">Radio</h1>
            <div class="controls">
                <button id="timer-btn" class="control-btn" title="Sleep Timer">
                    <svg id="timer-icon" viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>
                    <span id="timer-display" style="display:none; z-index: 3; position: relative;"></span>
                </button>
                <button id="sort-btn" class="control-btn" title="Sort by Location">
                    <svg viewBox="0 0 24 24"><path d="M3 18h6v-2H3v2zM3 6v2h18V6H3zm0 7h12v-2H3v2z"/></svg>
                </button>
                <button id="shuffle-btn" class="control-btn" title="Shuffle Station">
                    <svg viewBox="0 0 24 24">
                        <path d="M14.83 13.41L13.42 14.82L16.59 18H5V20H16.59L13.42 23.17L14.83 24.58L20.41 19L14.83 13.41Z" transform="translate(0, -3)"/>
                        <path d="M9.17 10.59L10.58 9.18L7.41 6H19V4H7.41L10.58 0.83L9.17 -0.58L3.59 5L9.17 10.59Z" transform="translate(0, 3)"/>
                    </svg>
                </button>
                <button id="play-pause-btn" class="control-btn" title="Play/Stop" disabled>
                    <svg id="play-pause-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                </button>
            </div>
        </div>
    </header>

    <div id="scroll-container">
        <div class="grid" id="station-grid"></div>
    </div>

    <audio id="radio-player" style="display:none;" preload="none"></audio>

    <script>
        const stations = [
            { name: "FIP", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/fip/fip.m3u8" },   
            { name: "EGO", geo: "ðŸ‡©ðŸ‡ª", type: "int", url: "https://cast.egofm.de/egofm.mp3" },   
            { name: "FM4", geo: "ðŸ‡©ðŸ‡ª", type: "int", url: "https://orf-live.ors-shoutcast.at/fm4-q2a" },
            { name: "STUD", geo: "ðŸ‡¸ðŸ‡®", type: "int", url: "https://kruljo.radiostudent.si:8001/test.ogg" },
            { name: "NOVA", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://novazz.ice.infomaniak.ch/novazz-128.mp3" },
            { name: "U92M", geo: "WV", type: "us", url: "https://stream.radiojar.com/56p3rt9eytzuv" },
            { name: "DEPA", geo: "IL", type: "us", url: "https://ice26.securenetsystems.net/RADIODEPAUL" },
            { name: "KRVS", geo: "LA", type: "us", url: "https://29223.live.streamtheworld.com/KRVSFMAAC.aac" },
            { name: "WKNC", geo: "NC", type: "us", url: "https://das-edge12-live365-dal02.cdnstream.com/a30009" },
            { name: "KCSU", geo: "CO", type: "us", url: "https://listen.kcsufm.com/stream" },
            { name: "WERS", geo: "MA", type: "us", url: "https://18503.live.streamtheworld.com/WERSFMAAC.aac" },
            { name: "KAMP", geo: "AZ", type: "us", url: "https://ice42.securenetsystems.net/KAMP" },
            { name: "WUTK", geo: "TN", type: "us", url: "https://26223.live.streamtheworld.com/WUTKFM.mp3" },
            { name: "WCBN", geo: "MI", type: "us", url: "https://floyd.wcbn.org:8443/wcbn-hd.mp3" },
            { name: "WREK", geo: "GA", type: "us", url: "https://streaming.wrek.org/main/320kb.mp3" },
            { name: "WBRU", geo: "RI", type: "us", url: "https://stream.radio.co/s4d09e922b/listen" },
            { name: "WRIU", geo: "RI", type: "us", url: "https://stream.wriu.org/wriu-fm" },
            { name: "KJHK", geo: "KS", type: "us", url: "https://listen.mixlr.com/86b854be3889dc43aed2f0eb6f2b814b" },
            { name: "WICB", geo: "NY", type: "us", url: "https://icecast.do.zufall.co/wicb_aac_high" },
            { name: "WXYC", geo: "NC", type: "us", url: "https://audio-mp3.ibiblio.org/wxyc.mp3" },
            { name: "KEXP", geo: "WA", type: "us", url: "https://kexp-mp3-128.streamguys1.com/kexp128.mp3" },
            { name: "WUOG", geo: "GA", type: "us", url: "https://stream.wuog.org/stream" },  
            { name: "KCRW", geo: "CA", type: "us", url: "https://streams.kcrw.com/kcrw_mp3" },
            { name: "WFMU", geo: "NJ", type: "us", url: "https://stream0.wfmu.org/freeform-128k" },
            { name: "WWOZ", geo: "LA", type: "us", url: "https://wwoz-sc.streamguys1.com/wwoz-hi.mp3" },
            { name: "KKJZ", geo: "CA", type: "us", url: "https://streaming.live365.com/a49833" },
            { name: "KNKX", geo: "WA", type: "us", url: "https://knkx-live-a.edge.audiocdn.com/6285_256k" },
            { name: "WPSU", geo: "PA", type: "us", url: "https://wpsu-ice.streamguys1.com/wpsu2" },
            { name: "KCSN", geo: "CA", type: "us", url: "https://www.streamvortex.com:8444/s/12200/" },
            { name: "WXPN", geo: "PA", type: "us", url: "https://wxpn.xpn.org/xpnmp3hi" },
            { name: "WKIT", geo: "ME", type: "us", url: "https://ice6.securenetsystems.net/WKIT" },
            { name: "WDBM", geo: "MI", type: "us", url: "https://play.impact89fm.org:8000/impact89fm" },
            { name: "WLUW", geo: "IL", type: "us", url: "https://ice26.securenetsystems.net/WLUW" },
            { name: "WNUR", geo: "IL", type: "us", url: "https://n16.rcs.revma.com/w4pmmfkdx4zuv" },
            { name: "WIIT", geo: "IL", type: "us", url: "https://icecast.iit.edu/WIITstream" },
            { name: "WRAS", geo: "GA", type: "us", url: "https://gpb.streamguys1.com/oom/gpb-radio-mp3-website" },   
            { name: "KING", geo: "WA", type: "us", url: "https://classicalking.streamguys1.com/king-fm-aac-128k" },     
            { name: "KVCU", geo: "CO", type: "us", url: "https://kvcu.streamguys1.com/live" },   
            { name: "WBOR", geo: "ME", type: "us", url: "https://listen.wbor.org/" },   
            { name: "WZND", geo: "IL", type: "us", url: "https://14543.live.streamtheworld.com/WZNDFM.mp3" },
            { name: "WASU", geo: "NC", type: "us", url: "https://prod-54-85-93-254.amperwave.net/wasu-wasuaac-hlsc1.m3u8" },
            { name: "KXLU", geo: "CA", type: "us", url: "https://kxlu.streamguys1.com/kxlu-hi" },
            { name: "WXRT", geo: "IL", type: "us", url: "https://prod-3-83-123-147.amperwave.net/audacy-wxrtfmaac-hlsc.m3u8" }, 
            { name: "WTJU", geo: "VA", type: "us", url: "https://streams.wtju.net/wtju-live.mp3" },
            { name: "KVRX", geo: "TX", type: "us", url: "https://streams.kut.org/5020_192.mp3" },
            { name: "WUMF", geo: "ME", type: "us", url: "http://wumfstreaming.umf.maine.edu:8000/wumf" },
            { name: "WMEB", geo: "ME", type: "us", url: "http://wmeb-stream.maine.edu:8000/wmeb" },
            { name: "WQFS", geo: "NC", type: "us", url: "http://wqfs.arcostream.com:7109/wqfs" },
        ];

        stations.forEach((s, i) => s.id = i);

        const grid = document.getElementById('station-grid');
        const player = document.getElementById('radio-player');
        const sortBtn = document.getElementById('sort-btn');
        const timerBtn = document.getElementById('timer-btn');
        const timerIcon = document.getElementById('timer-icon');
        const timerDisplay = document.getElementById('timer-display');
        const shuffleBtn = document.getElementById('shuffle-btn');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const playPauseIcon = document.getElementById('play-pause-icon');
        const appTitle = document.getElementById('app-title');
        const scrollContainer = document.getElementById('scroll-container');

        const playPath = "M8 5v14l11-7z";
        const stopPath = "M6 6h12v12H6z";

        let currentStationId = parseInt(localStorage.getItem('lastStationId')) || null;
        let bufferingStationId = null; 
        let errorStationId = null; 
        let isActuallyPlaying = false;
        let isLocationSorted = false;
        let favoriteIds = JSON.parse(localStorage.getItem('favStations') || '[]');
        let logicalMasterList = [];

        let currentTimerDuration = 0; 
        let sleepTimerTimeout = null;
        let sleepTickInterval = null;

        appTitle.onclick = () => {
            let clickCount = parseInt(appTitle.dataset.clicks || 0) + 1;
            appTitle.dataset.clicks = clickCount;
            if (clickCount >= 2) window.location.reload(true);
            setTimeout(() => appTitle.dataset.clicks = 0, 500); 
        };

        function renderGrid() {
            grid.innerHTML = '';
            let favs = stations.filter(s => favoriteIds.includes(s.id));
            let others = stations.filter(s => !favoriteIds.includes(s.id));

            if (isLocationSorted) {
                const sortLogic = (a, b) => {
                    if (a.type === "int" && b.type === "us") return -1;
                    if (a.type === "us" && b.type === "int") return 1;
                    return a.geo.localeCompare(b.geo);
                };
                favs.sort(sortLogic); others.sort(sortLogic);
            }

            logicalMasterList = [...favs, ...others];
            let anchorStation = null;
            let visualList = [...logicalMasterList];

            if (currentStationId !== null) {
                const index = visualList.findIndex(s => s.id === currentStationId);
                if (index > -1) [anchorStation] = visualList.splice(index, 1);
            }

            const activeDisplayList = anchorStation ? [anchorStation, ...visualList] : visualList;

            activeDisplayList.forEach((station) => {
                const tile = document.createElement('div');
                tile.className = `tile c${(station.id % 8) + 1}`;
                if (favoriteIds.includes(station.id)) tile.classList.add('is-fav');
                
                if (bufferingStationId === station.id) tile.classList.add('buffering');
                else if (errorStationId === station.id) tile.classList.add('error');
                else if (currentStationId === station.id) {
                    tile.classList.add(isActuallyPlaying ? 'active' : 'ready');
                    if (!isActuallyPlaying) playPauseBtn.disabled = false;
                }
                
                tile.dataset.id = station.id;
                const flagMatch = station.geo.match(/[\u{1F1E6}-\u{1F1FF}]{2}/u);
                const flagEmoji = flagMatch ? flagMatch[0] : "";
                const stateText = station.geo.replace(flagEmoji, "").trim();

                tile.innerHTML = `
                    <div class="fav-star">â˜…</div>
                    <div class="status-container">
                        <div class="spinner"></div>
                        <svg class="error-icon" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                        </svg>
                        <svg class="tile-play-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                        <div class="eq-container">
                            <div class="eq-bar"></div><div class="eq-bar"></div><div class="eq-bar"></div><div class="eq-bar"></div>
                        </div>
                    </div>
                    <div class="tile-name">${station.name}</div>
                    <div class="geo-tag">
                        <span class="geo-text">${stateText}</span>
                        <span class="geo-flag">${flagEmoji}</span>
                    </div>
                `;
                tile.querySelector('.fav-star').onclick = (e) => { e.stopPropagation(); toggleFavorite(station.id); };
                tile.onclick = () => handleTileClick(station.id);
                grid.appendChild(tile);
            });
        }

        timerBtn.onclick = () => {
            if (currentTimerDuration === 0) startSleepTimer(30);
            else if (currentTimerDuration === 30) startSleepTimer(15);
            else clearSleepTimer();
        };

        function startSleepTimer(minutes) {
            if (sleepTimerTimeout) clearTimeout(sleepTimerTimeout);
            if (sleepTickInterval) clearInterval(sleepTickInterval);
            timerBtn.classList.remove('active'); void timerBtn.offsetWidth; timerBtn.classList.add('active');
            currentTimerDuration = minutes;
            timerIcon.style.display = 'none'; timerDisplay.style.display = 'block'; timerDisplay.innerText = currentTimerDuration;
            let remaining = minutes;
            sleepTickInterval = setInterval(() => {
                remaining--;
                if (remaining <= 0) { stopPlayback(); clearSleepTimer(); } else timerDisplay.innerText = remaining;
            }, 60000);
            sleepTimerTimeout = setTimeout(() => { stopPlayback(); clearSleepTimer(); }, minutes * 60000);
        }

        function clearSleepTimer() {
            if (sleepTimerTimeout) clearTimeout(sleepTimerTimeout);
            if (sleepTickInterval) clearInterval(sleepTickInterval);
            sleepTimerTimeout = null; sleepTickInterval = null; currentTimerDuration = 0;
            timerBtn.classList.remove('active'); timerIcon.style.display = 'block'; timerDisplay.style.display = 'none';
        }

        function toggleFavorite(id) {
            if (favoriteIds.includes(id)) favoriteIds = favoriteIds.filter(fid => fid !== id);
            else favoriteIds.push(id);
            localStorage.setItem('favStations', JSON.stringify(favoriteIds)); renderGrid();
        }

        function handleTileClick(id) {
            if (currentStationId === id && isActuallyPlaying) stopPlayback();
            else playStation(id);
        }

        function setupMediaHandlers() {
            if ('mediaSession' in navigator) {
                navigator.mediaSession.setActionHandler('previoustrack', () => navigateStation(-1));
                navigator.mediaSession.setActionHandler('nexttrack', () => navigateStation(1));
                navigator.mediaSession.setActionHandler('play', () => { if (currentStationId !== null) playStation(currentStationId); });
                navigator.mediaSession.setActionHandler('pause', () => stopPlayback());
            }
        }

        function navigateStation(direction) {
            const currentIndex = logicalMasterList.findIndex(s => s.id === currentStationId);
            const nextIndex = (currentIndex + direction + logicalMasterList.length) % logicalMasterList.length;
            playStation(logicalMasterList[nextIndex].id);
        }

        function updateMediaMetadata(station) {
            if ('mediaSession' in navigator) {
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: station.name, artist: "Radio", album: station.geo,
                    artwork: [{ src: 'image_0.png.jpg', sizes: '512x512', type: 'image/png' }]
                });
                navigator.mediaSession.playbackState = "playing"; setupMediaHandlers(); 
            }
            document.title = `${station.name} - Radio`;
        }

        function playStation(id) {
            const station = stations.find(s => s.id === id);
            errorStationId = null;
            bufferingStationId = id;
            isActuallyPlaying = false;
            renderGrid();

            player.src = station.url;
            player.play().then(() => {
                bufferingStationId = null;
                currentStationId = id;
                isActuallyPlaying = true;
                localStorage.setItem('lastStationId', id);
                playPauseBtn.disabled = false;
                updatePlayPauseButton(true);
                renderGrid();
                scrollContainer.scrollTo({top: 0, behavior: 'smooth'});
                updateMediaMetadata(station);
            }).catch(e => {
                bufferingStationId = null;
                errorStationId = id;
                renderGrid();
            });
        }

        player.onerror = () => {
            if (bufferingStationId !== null) {
                errorStationId = bufferingStationId;
                bufferingStationId = null;
                renderGrid();
            }
        };

        function stopPlayback() {
            player.pause(); isActuallyPlaying = false;
            if ('mediaSession' in navigator) navigator.mediaSession.playbackState = "paused";
            updatePlayPauseButton(false); renderGrid(); document.title = "Radio";
        }

        function updatePlayPauseButton(playing) { playPauseIcon.innerHTML = `<path d="${playing ? stopPath : playPath}"/>`; }

        let touchstartX = 0; let touchendX = 0;
        document.addEventListener('touchstart', e => { touchstartX = e.changedTouches[0].screenX; }, {passive: true});
        document.addEventListener('touchend', e => {
            touchendX = e.changedTouches[0].screenX; const diff = touchstartX - touchendX;
            if (Math.abs(diff) > 100) { if (diff > 0) navigateStation(1); else navigateStation(-1); }
        }, {passive: true});

        sortBtn.onclick = () => { 
            isLocationSorted = !isLocationSorted; 
            if (isLocationSorted) sortBtn.classList.add('active'); else sortBtn.classList.remove('active');
            renderGrid(); 
        };

        shuffleBtn.onclick = () => { const randomIndex = Math.floor(Math.random() * stations.length); playStation(stations[randomIndex].id); };
        playPauseBtn.onclick = () => { if (isActuallyPlaying) stopPlayback(); else if (currentStationId !== null) playStation(currentStationId); };

        renderGrid(); setupMediaHandlers();
        document.addEventListener('touchmove', function (e) { if (e.target.closest('#scroll-container')) return; e.preventDefault(); }, { passive: false });
    </script>
</body>
</html>
