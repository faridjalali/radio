<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Radio</title>
    
    <link rel="icon" type="image/jpeg" href="image_0.png.jpg">
    <link rel="apple-touch-icon" href="image_0.png.jpg">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        :root {
            --bg-color: #000000;
            --text-color: #ffffff;
            --accent-color: #0078d7; 
            --disabled-color: #444;
            --fav-color: #ffca28;
        }

        @property --wipe-angle {
          syntax: '<angle>';
          initial-value: 0deg;
          inherits: false;
        }

        html, body {
            position: fixed;
            overflow: hidden;
            width: 100%; height: 100%;
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: "Segoe UI", "Segoe UI Semibold", Tahoma, sans-serif;
            -webkit-tap-highlight-color: transparent;
            touch-action: none; 
        }

        header {
            position: absolute;
            top: 0; width: 100%; z-index: 1000;
            background-color: rgba(0,0,0,0.85);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            padding-top: calc(env(safe-area-inset-top) + 15px); 
            padding-bottom: 12px;
            touch-action: pan-y;
        }

        .header-inner {
            max-width: 1600px; margin: 0 auto;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 30px; box-sizing: border-box;
        }

        .brand-container {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            user-select: none;
        }

        h1 { font-weight: 200; font-size: 2.4rem; margin: 0; letter-spacing: -1px; }

        #menu-arrow {
            width: 22px;
            height: 22px;
            fill: #ffffff;
            opacity: 0.9;
            transition: transform 0.3s ease;
            margin-top: 8px;
        }

        .brand-container.active #menu-arrow { transform: rotate(180deg); }

        #dropdown-menu {
            position: absolute;
            top: 100%;
            left: 30px;
            width: 280px;
            background-color: rgba(15,15,15,0.98);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            display: none;
            flex-direction: column;
            max-height: 65vh;
            overflow-y: auto;
            z-index: 2000;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
            padding: 15px 0;
            margin-top: 10px;
            touch-action: pan-y; 
        }

        #dropdown-menu.visible { display: flex; animation: menuFade 0.2s ease; }

        @keyframes menuFade {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .menu-label {
            padding: 5px 20px 8px 20px;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--accent-color);
            font-weight: 700;
        }

        .menu-item {
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .menu-item:hover { background: rgba(255,255,255,0.1); }
        .menu-item.active { color: var(--accent-color); font-weight: 600; }

        .flag-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            padding: 5px 20px 15px 20px;
        }

        .flag-btn {
            font-size: 1.6rem;
            cursor: pointer;
            padding: 4px;
            border-radius: 6px;
            transition: background 0.2s;
            line-height: 1;
        }

        .flag-btn:hover { background: rgba(255,255,255,0.1); }
        .flag-btn.active { background: var(--accent-color); }

        .menu-divider {
            height: 1px;
            background: rgba(255,255,255,0.1);
            margin: 10px 0;
        }

        .controls { display: flex; gap: 8px; }

        .control-btn {
            position: relative;
            background: none; border: 1.5px solid rgba(255,255,255,0.2);
            border-radius: 50%; width: 40px; height: 40px;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: all 0.2s ease; color: white; font-size: 0.9rem; font-weight: 600;
            overflow: hidden;
        }

        .control-btn.active { background-color: var(--accent-color); border-color: var(--accent-color); }

        #timer-btn.active {
            background: conic-gradient(transparent var(--wipe-angle), var(--accent-color) 0deg);
            border-color: var(--accent-color);
            animation: wipeClockwise 60s linear infinite;
        }

        @keyframes wipeClockwise { from { --wipe-angle: 0deg; } to { --wipe-angle: 360deg; } }

        .control-btn:hover:not(:disabled) { border-color: white; background-color: rgba(255,255,255,0.1); }
        .control-btn.active:hover { background-color: #0086f0; }
        .control-btn:disabled { border-color: var(--disabled-color); cursor: not-allowed; }
        .control-btn svg { fill: white; width: 16px; height: 16px; display: block; }

        #scroll-container {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            overflow-y: auto; -webkit-overflow-scrolling: touch;
            padding-top: calc(95px + env(safe-area-inset-top)); 
            padding-bottom: env(safe-area-inset-bottom);
            touch-action: pan-y;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(175px, 1fr));
            gap: 15px; max-width: 1600px; margin: 0 auto;
            padding: 10px 30px 20px 30px; box-sizing: border-box;
        }

        @media (max-width: 600px) {
            .grid { grid-template-columns: repeat(2, 1fr); padding: 10px 15px 20px 15px; gap: 10px; }
            .header-inner { padding: 0 15px; }
            h1 { font-size: 2rem; }
            #dropdown-menu { left: 15px; width: calc(100% - 30px); }
            #scroll-container { padding-top: calc(85px + env(safe-area-inset-top)); }
        }

        .tile {
            aspect-ratio: 1 / 1; position: relative;
            padding: 15px; cursor: pointer;
            transition: transform 0.2s ease, filter 0.2s ease;
            overflow: hidden;
        }

        .tile::after {
            content: ''; position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(circle at bottom right, rgba(0,0,0,0.35) 0%, transparent 65%);
            pointer-events: none; z-index: 1;
        }

        .tile:hover { filter: brightness(1.2); }
        .tile.active { outline: 4px solid white; outline-offset: -4px; }

        .fav-star {
            position: absolute; top: 20px; left: 15px;
            font-size: 1.2rem; line-height: 1;
            color: rgba(255, 255, 255, 0.3); transition: all 0.2s ease; z-index: 10;
        }

        .tile.is-fav .fav-star { color: var(--fav-color); }

        .status-container {
            position: absolute; top: 19px; right: 15px;
            z-index: 3; display: flex;
            justify-content: flex-end; align-items: flex-start;
        }

        .spinner {
            display: none; width: 18px; height: 18px;
            border: 2px solid rgba(255,255,255,0.2);
            border-top-color: white; border-radius: 50%;
            animation: spin 0.8s linear infinite; pointer-events: none;
            margin-top: 3px; margin-right: 3px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .tile.buffering .spinner { display: block; }

        .error-icon {
            display: none; width: 24px; height: 24px;
            fill: white; pointer-events: none;
        }
        .tile.error .error-icon { display: block; }

        .tile-play-icon { width: 24px; height: 24px; fill: white; display: none; pointer-events: none; }
        .tile.ready .tile-play-icon { display: block; }
        .tile.buffering .tile-play-icon, .tile.error .tile-play-icon { display: none; }

        .eq-container {
            display: none; align-items: flex-end; gap: 1.5px;
            height: 12px; width: 20px;
            pointer-events: none; margin-top: 4px;
        }
        .tile.active .eq-container { display: flex; }
        .tile.buffering .eq-container, .tile.error .eq-container { display: none; }

        .eq-bar { background-color: white; width: 3px; border-radius: 1px; height: 30%; }
        .tile.active .eq-bar { animation: rollingWave 0.8s ease-in-out infinite; }
        .tile.active .eq-bar:nth-child(1) { animation-delay: 0.0s; }
        .tile.active .eq-bar:nth-child(2) { animation-delay: 0.1s; }
        .tile.active .eq-bar:nth-child(3) { animation-delay: 0.2s; }
        .tile.active .eq-bar:nth-child(4) { animation-delay: 0.3s; }

        @keyframes rollingWave { 0%, 100% { height: 30%; } 50% { height: 100%; } }

        .tile-info-stack {
            position: absolute;
            bottom: 15px;
            left: 15px;
            display: flex;
            flex-direction: column;
            gap: 2px;
            pointer-events: none;
            z-index: 2;
            max-width: calc(100% - 80px);
        }

        .tile-main-genre {
            font-size: 0.75rem;
            font-weight: 400;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tile-name {
            font-size: 1.4rem;
            font-weight: 600;
            letter-spacing: -0.5px;
            line-height: 1;
            text-transform: uppercase;
        }

        .geo-tag {
            position: absolute; bottom: 15px; right: 15px;
            z-index: 2; text-align: right; display: flex;
            align-items: center; gap: 4px; line-height: 1;
        }

        .geo-text { font-size: 0.8rem; font-weight: 400; opacity: 0.9; }
        .geo-flag { font-size: 1.3rem; display: inline-block; }

        .c1 { background-color: #00A300; } .c2 { background-color: #2D89EF; } 
        .c3 { background-color: #9F00A7; } .c4 { background-color: #603CBA; } 
        .c5 { background-color: #DA532C; } .c6 { background-color: #B91D47; } 
        .c7 { background-color: #00ABA9; } .c8 { background-color: #7E3878; } 

    </style>
</head>
<body>

    <header>
        <div class="header-inner">
            <div class="brand-container" id="brand-area">
                <h1 id="app-title">Radio</h1>
                <svg id="menu-arrow" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg>
            </div>
            
            <div id="dropdown-menu"></div>

            <div class="controls">
                <button id="timer-btn" class="control-btn" title="Sleep Timer">
                    <svg id="timer-icon" viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>
                    <span id="timer-display" style="display:none; z-index: 3; position: relative;"></span>
                </button>
                <button id="sort-btn" class="control-btn" title="Sort Alphabetically">
                    <svg viewBox="0 0 24 24"><path d="M3 18h6v-2H3v2zM3 6v2h18V6H3zm0 7h12v-2H3v2z"/></svg>
                </button>
                <button id="shuffle-btn" class="control-btn" title="Shuffle Contextual">
                    <svg viewBox="0 0 24 24">
                        <path d="M14.83 13.41L13.42 14.82L16.59 18H5V20H16.59L13.42 23.17L14.83 24.58L20.41 19L14.83 13.41Z" transform="translate(0, -3)"/>
                        <path d="M9.17 10.59L10.58 9.18L7.41 6H19V4H7.41L10.58 0.83L9.17 -0.58L3.59 5L9.17 10.59Z" transform="translate(0, 3)"/>
                    </svg>
                </button>
                <button id="play-pause-btn" class="control-btn" title="Play/Stop" disabled>
                    <svg id="play-pause-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                </button>
            </div>
        </div>
    </header>

    <div id="scroll-container">
        <div class="grid" id="station-grid"></div>
    </div>

    <audio id="radio-player" style="display:none;" preload="none"></audio>

    <script>
        const stations = [
            { name: "FIP", genre: "Eclectic", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/fip/fip_hifi.m3u8?id=radiofrance" },   
            { name: "EGO", genre: "Eclectic", geo: "ðŸ‡©ðŸ‡ª", type: "int", url: "https://cast.egofm.de/egofm.mp3" },   
            { name: "FM4", genre: "Alternative", geo: "ðŸ‡¦ðŸ‡¹", type: "int", url: "https://orf-live.ors-shoutcast.at/fm4-q2a" },
            { name: "STUD", genre: "Eclectic", geo: "ðŸ‡¸ðŸ‡®", type: "int", url: "https://kruljo.radiostudent.si:8001/test.ogg" },
            { name: "NOVA", genre: "World", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://novazz.ice.infomaniak.ch/novazz-128.mp3" },
            { name: "U92M", genre: "Eclectic", geo: "WV", type: "us", url: "https://stream.radiojar.com/56p3rt9eytzuv" },
            { name: "DEPA", genre: "Eclectic", geo: "IL", type: "us", url: "https://ice26.securenetsystems.net/RADIODEPAUL" },
            { name: "KRVS", genre: "Eclectic", geo: "LA", type: "us", url: "https://29223.live.streamtheworld.com/KRVSFMAAC.aac" },
            { name: "WKNC", genre: "Eclectic", geo: "NC", type: "us", url: "https://das-edge12-live365-dal02.cdnstream.com/a30009" },
            { name: "KCSU", genre: "Eclectic", geo: "CO", type: "us", url: "https://listen.kcsufm.com/stream" },
            { name: "WERS", genre: "Eclectic", geo: "MA", type: "us", url: "https://18503.live.streamtheworld.com/WERSFMAAC.aac" },
            { name: "KAMP", genre: "Eclectic", geo: "AZ", type: "us", url: "https://ice42.securenetsystems.net/KAMP" },
            { name: "WUTK", genre: "Eclectic", geo: "TN", type: "us", url: "https://26223.live.streamtheworld.com/WUTKFM.mp3" },
            { name: "WCBN", genre: "Eclectic", geo: "MI", type: "us", url: "https://floyd.wcbn.org:8443/wcbn-hd.mp3" },
            { name: "WREK", genre: "Eclectic", geo: "GA", type: "us", url: "https://streaming.wrek.org/main/320kb.mp3" },
            { name: "WBRU", genre: "Eclectic", geo: "RI", type: "us", url: "https://stream.radio.co/s4d09e922b/listen" },
            { name: "WRIU", genre: "Eclectic", geo: "RI", type: "us", url: "https://stream.wriu.org/wriu-fm" },
            { name: "KJHK", genre: "Eclectic", geo: "KS", type: "us", url: "https://listen.mixlr.com/86b854be3889dc43aed2f0eb6f2b814b" },
            { name: "WICB", genre: "Eclectic", geo: "NY", type: "us", url: "https://icecast.do.zufall.co/wicb_aac_high" },
            { name: "WXYC", genre: "Eclectic", geo: "NC", type: "us", url: "https://audio-mp3.ibiblio.org/wxyc.mp3" },
            { name: "KEXP", genre: "Eclectic", geo: "WA", type: "us", url: "https://kexp-mp3-128.streamguys1.com/kexp128.mp3" },
            { name: "WUOG", genre: "Eclectic", geo: "GA", type: "us", url: "https://stream.wuog.org/stream" },  
            { name: "KCRW", genre: "Eclectic", geo: "CA", type: "us", url: "https://streams.kcrw.com/kcrw_mp3" },
            { name: "WFMU", genre: "Eclectic", geo: "NJ", type: "us", url: "https://stream0.wfmu.org/freeform-128k" },
            { name: "WWOZ", genre: "Jazz", geo: "LA", type: "us", url: "https://wwoz-sc.streamguys1.com/wwoz-hi.mp3" },
            { name: "KKJZ", genre: "Eclectic", geo: "CA", type: "us", url: "https://streaming.live365.com/a49833" },
            { name: "KNKX", genre: "Jazz", geo: "WA", type: "us", url: "https://knkx-live-a.edge.audiocdn.com/6285_256k" },
            { name: "WPSU", genre: "Eclectic", geo: "PA", type: "us", url: "https://wpsu-ice.streamguys1.com/wpsu2" },
            { name: "KCSN", genre: "Eclectic", geo: "CA", type: "us", url: "https://www.streamvortex.com:8444/s/12200/" },
            { name: "WXPN", genre: "Eclectic", geo: "PA", type: "us", url: "https://wxpn.xpn.org/xpnmp3hi" },
            { name: "WKIT", genre: "Rock", geo: "ME", type: "us", url: "https://ice6.securenetsystems.net/WKIT" },
            { name: "WDBM", genre: "Eclectic", geo: "MI", type: "us", url: "https://play.impact89fm.org:8000/impact89fm" },
            { name: "WLUW", genre: "Eclectic", geo: "IL", type: "us", url: "https://ice26.securenetsystems.net/WLUW" },
            { name: "WNUR", genre: "Eclectic", geo: "IL", type: "us", url: "https://n16.rcs.revma.com/w4pmmfkdx4zuv" },
            { name: "WIIT", genre: "Eclectic", geo: "IL", type: "us", url: "https://icecast.iit.edu/WIITstream" },
            { name: "WRAS", genre: "Eclectic", geo: "GA", type: "us", url: "https://gpb.streamguys1.com/oom/gpb-radio-mp3-website" },   
            { name: "KING", genre: "Classical", geo: "WA", type: "us", url: "https://classicalking.streamguys1.com/king-fm-aac-128k" },     
            { name: "KVCU", genre: "Eclectic", geo: "CO", type: "us", url: "https://kvcu.streamguys1.com/live" },   
            { name: "WBOR", genre: "Eclectic", geo: "ME", type: "us", url: "https://listen.wbor.org/" },   
            { name: "WZND", genre: "Eclectic", geo: "IL", type: "us", url: "https://14543.live.streamtheworld.com/WZNDFM.mp3" },
            { name: "WASU", genre: "Eclectic", geo: "NC", type: "us", url: "https://prod-54-85-93-254.amperwave.net/wasu-wasuaac-hlsc1.m3u8" },
            { name: "KXLU", genre: "Eclectic", geo: "CA", type: "us", url: "https://kxlu.streamguys1.com/kxlu-hi" },
            { name: "WXRT", genre: "Eclectic", geo: "IL", type: "us", url: "https://prod-3-83-123-147.amperwave.net/audacy-wxrtfmaac-hlsc.m3u8" }, 
            { name: "WTJU", genre: "Eclectic", geo: "VA", type: "us", url: "https://streams.wtju.net/wtju-live.mp3" },
            { name: "KVRX", genre: "Eclectic", geo: "TX", type: "us", url: "https://streams.kut.org/5020_192.mp3" },
            { name: "WUMF", genre: "Eclectic", geo: "ME", type: "us", url: "http://wumfstreaming.umf.maine.edu:8000/wumf" },
            { name: "WMEB", genre: "Eclectic", geo: "ME", type: "us", url: "http://wmeb-stream.maine.edu:8000/wmeb" },
            { name: "WQFS", genre: "Eclectic", geo: "NC", type: "us", url: "http://wqfs.arcostream.com:7109/wqfs" },
            { name: "FOLK", genre: "Folk", geo: "OH", type: "us", url: "https://freshgrass.streamguys1.com/folkalley-128mp3" },
            { name: "WPRM", genre: "Classical", geo: "WI", type: "us", url: "https://wpr-ice.streamguys1.com/wpr-music-mp3-96" },
            { name: "HPR", genre: "Folk", geo: "MN", type: "us", url: "https://radioheartland.stream.publicradio.org/radioheartland.aac" },
            { name: "WAMU", genre: "Eclectic", geo: "DC", type: "us", url: "https://ice24.securenetsystems.net/WAMU" },
            { name: "WQXR", genre: "Classical", geo: "NY", type: "us", url: "https://stream.wqxr.org/wqxr-web" },
            { name: "KUSC", genre: "Classical", geo: "CA", type: "us", url: "https://16603.live.streamtheworld.com/KUSCAAC96.aac" },
            { name: "WFMT", genre: "Classical", geo: "IL", type: "us", url: "https://wfmt.streamguys1.com/main-mp3" },
            { name: "WGBH", genre: "Classical", geo: "MA", type: "us", url: "https://wgbh-live.streamguys1.com/classical-hi/" },
            { name: "WCPE", genre: "Classical", geo: "NC", type: "us", url: "https://18093.live.streamtheworld.com/WCPE_FM.mp3" },
            { name: "KQAC", genre: "Classical", geo: "OR", type: "us", url: "https://allclassical.streamguys1.com/ac128kmp3" },
            { name: "CMPR", genre: "Classical", geo: "MN", type: "us", url: "https://ycradio.stream.publicradio.org/ycradio.aac" },
            { name: "KMFA", genre: "Classical", geo: "TX", type: "us", url: "https://kmfa.streamguys1.com/KMFA-mp3" },
            { name: "WETA", genre: "Classical", geo: "DC", type: "us", url: "https://weta.streamguys1.com/wetaclassical-icy" },
            { name: "RSC", genre: "Classical", geo: "ðŸ‡¨ðŸ‡­", type: "int", url: "https://livestreaming-node-3.srg-ssr.ch/srgssr/rsc_de/aac/96" },
            { name: "VCR", genre: "Classical", geo: "ðŸ‡®ðŸ‡¹", type: "int", url: "https://de2.streamingpulse.com/ssl/vcr1" },
            { name: "VCR+", genre: "Classical", geo: "ðŸ‡®ðŸ‡¹", type: "int", url: "https://de2.streamingpulse.com/ssl/vcr2" },
            { name: "FMUS", genre: "Classical", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/francemusique/francemusique_hifi.m3u8?id=radiofrance" },
            { name: "BRK", genre: "Classical", geo: "ðŸ‡©ðŸ‡ª", type: "int", url: "https://mcdn.hf.br.de/br/hf/brklassik/master-256000.m3u8" },
            { name: "ABCC", genre: "Classical", geo: "ðŸ‡¦ðŸ‡º", type: "int", url: "https://mediaserviceslive.akamaized.net/hls/live/2108547/classicfmnsw/v0-221.m3u8" },
            { name: "CBCM", genre: "Pop", geo: "ðŸ‡¨ðŸ‡¦", type: "int", url: "https://cbcradiolive.akamaized.net/hls/live/2041059/ES_R2PVC/adaptive_192/chunklist_ao.m3u8" },
            { name: "NPOR", genre: "Classical", geo: "ðŸ‡³ðŸ‡±", type: "int", url: "https://icecast.omroep.nl/radio4-sb-aac" },
            { name: "OPUS", genre: "Classical", geo: "ðŸ‡²ðŸ‡½", type: "int", url: "https://s2.mexside.net:7014/stream" },
            { name: "BBC1", genre: "Pop", geo: "ðŸ‡¬ðŸ‡§", type: "int", url: "https://lsn.lv/bbcradio.m3u8?station=bbc_radio_one&bitrate=320000" },
            { name: "BBC1A", genre: "Pop", geo: "ðŸ‡¬ðŸ‡§", type: "int", url: "https://lsn.lv/bbcradio.m3u8?station=bbc_radio_one_anthems&bitrate=320000" },
            { name: "BBC1D", genre: "Dance", geo: "ðŸ‡¬ðŸ‡§", type: "int", url: "https://lsn.lv/bbcradio.m3u8?station=bbc_radio_one_dance&bitrate=320000" },
            { name: "BBC1X", genre: "Hip Hop", geo: "ðŸ‡¬ðŸ‡§", type: "int", url: "https://lsn.lv/bbcradio.m3u8?station=bbc_1xtra&bitrate=320000" },
            { name: "BBC2", genre: "Pop", geo: "ðŸ‡¬ðŸ‡§", type: "int", url: "https://lsn.lv/bbcradio.m3u8?station=bbc_radio_two&bitrate=320000" },
            { name: "BBC3", genre: "Classical", geo: "ðŸ‡¬ðŸ‡§", type: "int", url: "https://lsn.lv/bbcradio.m3u8?station=bbc_radio_three&bitrate=320000" },
            { name: "BBC3U", genre: "Classical", geo: "ðŸ‡¬ðŸ‡§", type: "int", url: "https://lsn.lv/bbcradio.m3u8?station=bbc_radio_three_unwind&bitrate=320000" },
            { name: "BBC6", genre: "Alternative", geo: "ðŸ‡¬ðŸ‡§", type: "int", url: "https://lsn.lv/bbcradio.m3u8?station=bbc_6music&bitrate=320000" },
            { name: "IDM", genre: "Dance", geo: "ðŸ‡¬ðŸ‡§", type: "int", url: "https://stream.indemandradio.com/stream/160/160.m3u8" },
            { name: "IDD", genre: "Pop", geo: "ðŸ‡¬ðŸ‡§", type: "int", url: "https://stream.indemandradio.com/stream/160/160.m3u8" },
            { name: "JKE", genre: "Rock", geo: "ðŸ‡¬ðŸ‡§", type: "int", url: "https://media.radiojackie.com/redirector/frontend.m3u8" },
            { name: "VCE", genre: "Pop", geo: "ðŸ‡¬ðŸ‡§", type: "int", url: "https://secure.mystreaming.net/thevoice/live128aac/chunks.m3u8" },
            { name: "FIPC", genre: "Rock", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/fipcultes/fipcultes_hifi.m3u8?id=radiofrance" },
            { name: "FIPSF", genre: "World", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/fipsacrefrancais/fipsacrefrancais_hifi.m3u8?id=radiofrance" },
            { name: "FIPRO", genre: "Rock", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/fiprock/fiprock_hifi.m3u8?id=radiofrance" },
            { name: "FIPJ", genre: "Jazz", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/fipjazz/fipjazz_hifi.m3u8?id=radiofrance" },
            { name: "FIPG", genre: "Jazz", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/fipgroove/fipgroove_hifi.m3u8?id=radiofrance" },
            { name: "FIPRE", genre: "Reggae", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/fipreggae/fipreggae_hifi.m3u8?id=radiofrance" },
            { name: "FIPP", genre: "Pop", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/fippop/fippop_hifi.m3u8?id=radiofrance" },
            { name: "FIPE", genre: "Dance", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/fipelectro/fipelectro_hifi.m3u8?id=radiofrance" },
            { name: "FIPM", genre: "World", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/fipworld/fipworld_hifi.m3u8?id=radiofrance" },
            { name: "FIPN", genre: "Eclectic", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/fipnouveautes/fipnouveautes_hifi.m3u8?id=radiofrance" },
            { name: "FIPHH", genre: "Hip Hop", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/fiphiphop/fiphiphop_hifi.m3u8?id=radiofrance" },
            { name: "RFFM", genre: "World", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/francemusique/francemusique_hifi.m3u8?id=radiofrance" },
            { name: "RFCE", genre: "Classical", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/francemusiqueeasyclassique/francemusiqueeasyclassique_hifi.m3u8?id=radiofrance" },
            { name: "RFCL", genre: "Classical", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/francemusiqueclassiquelove/francemusiqueclassiquelove_hifi.m3u8?id=radiofrance" },
            { name: "RFBA", genre: "Classical", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/francemusiquebaroque/francemusiquebaroque_hifi.m3u8?id=radiofrance" },
            { name: "RFPZ", genre: "Classical", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/francemusiquepianozen/francemusiquepianozen_hifi.m3u8?id=radiofrance" },
            { name: "RFFI", genre: "Classical", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/francemusiquelabo/francemusiquelabo_hifi.m3u8?id=radiofrance" },
            { name: "RFCO", genre: "Classical", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/francemusiqueconcertsradiofrance/francemusiqueconcertsradiofrance_hifi.m3u8?id=radiofrance" },
            { name: "RFCP", genre: "Classical", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/francemusiqueclassiqueplus/francemusiqueclassiqueplus_hifi.m3u8?id=radiofrance" },
            { name: "RFJA", genre: "Jazz", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/francemusiquelajazz/francemusiquelajazz_hifi.m3u8?id=radiofrance" },
            { name: "RFOP", genre: "Classical", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/francemusiqueopera/francemusiqueopera_hifi.m3u8?id=radiofrance" },
            { name: "RFLC", genre: "Classical", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/francemusiquelacontemporaine/francemusiquelacontemporaine_hifi.m3u8?id=radiofrance" },
            { name: "RFOM", genre: "Folk", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://stream.radiofrance.fr/francemusiqueocoramonde/francemusiqueocoramonde_hifi.m3u8?id=radiofrance" },
            { name: "NOVAC", genre: "Classical", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://nova-vnt.ice.infomaniak.ch/nova-vnt-128.mp3" },
            { name: "NOVAN", genre: "Hip Hop", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://nova-nouvo.ice.infomaniak.ch/nova-nouvo-128.mp3" },
            { name: "NOVAS", genre: "Jazz", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://nova-soul.ice.infomaniak.ch/nova-soul-128.mp3" },
            { name: "NOVAR", genre: "Reggae", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://nova-reggae.ice.infomaniak.ch/nova-reggae-128.mp3" },
            { name: "NOVAH", genre: "Hip Hop", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://nova-odn.ice.infomaniak.ch/nova-odn-128.mp3" },
            { name: "NOVALN", genre: "Jazz", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://nova-ln.ice.infomaniak.ch/nova-ln-128.mp3" },
            { name: "NOVAD", genre: "Dance", geo: "ðŸ‡«ðŸ‡·", type: "int", url: "https://nova-dance.ice.infomaniak.ch/nova-dance-128.mp3" },
        ];

        stations.forEach((s, i) => s.id = i);

        const countryFlagMap = {
            "France": "ðŸ‡«ðŸ‡·", "Germany": "ðŸ‡©ðŸ‡ª", "Austria": "ðŸ‡¦ðŸ‡¹", "Slovenia": "ðŸ‡¸ðŸ‡®", 
            "UK": "ðŸ‡¬ðŸ‡§", "Australia": "ðŸ‡¦ðŸ‡º", "Canada": "ðŸ‡¨ðŸ‡¦", "Netherlands": "ðŸ‡³ðŸ‡±", 
            "Mexico": "ðŸ‡²ðŸ‡½", "Switzerland": "ðŸ‡¨ðŸ‡­", "Italy": "ðŸ‡®ðŸ‡¹", "US": "ðŸ‡ºðŸ‡¸"
        };
        
        const reverseFlagMap = {};
        Object.entries(countryFlagMap).forEach(([k,v]) => reverseFlagMap[v] = k);

        const grid = document.getElementById('station-grid');
        const player = document.getElementById('radio-player');
        const sortBtn = document.getElementById('sort-btn');
        const timerBtn = document.getElementById('timer-btn');
        const timerIcon = document.getElementById('timer-icon');
        const timerDisplay = document.getElementById('timer-display');
        const shuffleBtn = document.getElementById('shuffle-btn');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const playPauseIcon = document.getElementById('play-pause-icon');
        const brandArea = document.getElementById('brand-area');
        const dropdownMenu = document.getElementById('dropdown-menu');
        const scrollContainer = document.getElementById('scroll-container');

        const playPath = "M8 5v14l11-7z";
        const stopPath = "M6 6h12v12H6z";

        let currentStationId = parseInt(localStorage.getItem('lastStationId')) || null;
        let bufferingStationId = null; 
        let errorStationId = null; 
        let isActuallyPlaying = false;
        let isAlphabeticalSorted = false; 
        let favoriteIds = JSON.parse(localStorage.getItem('favStations') || '[]');
        let logicalMasterList = [];
        let activeFilter = { type: 'all', value: null };

        brandArea.onclick = (e) => {
            e.stopPropagation();
            brandArea.classList.toggle('active');
            dropdownMenu.classList.toggle('visible');
        };

        document.onclick = (e) => {
            if (!e.target.closest('#dropdown-menu')) {
                brandArea.classList.remove('active');
                dropdownMenu.classList.remove('visible');
            }
        };

        function closeMenu() {
            brandArea.classList.remove('active');
            dropdownMenu.classList.remove('visible');
            scrollContainer.scrollTo({top: 0, behavior: 'smooth'});
        }

        function buildMenu() {
            dropdownMenu.innerHTML = '';
            
            const createItem = (label, type, val) => {
                const item = document.createElement('div');
                item.className = `menu-item ${activeFilter.type === type && activeFilter.value === val ? 'active' : ''}`;
                item.innerText = label;
                item.onclick = () => { activeFilter = { type, value: val }; renderGrid(); closeMenu(); };
                return item;
            };

            dropdownMenu.appendChild(createItem('Show All Stations', 'all', null));
            const cLabel = document.createElement('div');
            cLabel.className = 'menu-label'; cLabel.innerText = 'Countries';
            dropdownMenu.appendChild(cLabel);

            const flagGrid = document.createElement('div');
            flagGrid.className = 'flag-grid';
            
            const rawCountries = [...new Set(stations.map(s => s.type === 'us' ? 'US' : reverseFlagMap[s.geo] || s.geo))].sort();
            const usIdx = rawCountries.indexOf('US');
            if (usIdx > -1) rawCountries.unshift(rawCountries.splice(usIdx, 1)[0]);

            rawCountries.forEach(c => {
                const f = countryFlagMap[c] || c;
                const btn = document.createElement('div');
                btn.className = `flag-btn ${activeFilter.type === 'country' && activeFilter.value === c ? 'active' : ''}`;
                btn.innerText = f;
                btn.onclick = () => { activeFilter = { type: 'country', value: c }; renderGrid(); closeMenu(); };
                flagGrid.appendChild(btn);
            });
            dropdownMenu.appendChild(flagGrid);

            dropdownMenu.appendChild(document.createElement('div')).className = 'menu-divider';

            const gLabel = document.createElement('div');
            gLabel.className = 'menu-label'; gLabel.innerText = 'Genres';
            dropdownMenu.appendChild(gLabel);

            // REMOVED "TOP FOUR" LOGIC - ALL GENRES NOW LISTED ALPHABETICALLY
            const allGenres = [...new Set(stations.map(s => s.genre))].sort();

            allGenres.forEach(g => {
                const item = document.createElement('div');
                item.className = `menu-item ${activeFilter.type === 'genre' && activeFilter.value === g ? 'active' : ''}`;
                item.innerText = g;
                item.onclick = () => { activeFilter = { type: 'genre', value: g }; renderGrid(); closeMenu(); };
                dropdownMenu.appendChild(item);
            });
        }

        function renderGrid() {
            buildMenu();
            grid.innerHTML = '';
            let filtered = stations;
            if (activeFilter.type === 'country') {
                filtered = stations.filter(s => (activeFilter.value === 'US' ? s.type === 'us' : (reverseFlagMap[s.geo] || s.geo) === activeFilter.value));
            } else if (activeFilter.type === 'genre') {
                filtered = stations.filter(s => s.genre === activeFilter.value);
            }

            let favs = filtered.filter(s => favoriteIds.includes(s.id));
            let others = filtered.filter(s => !favoriteIds.includes(s.id));

            if (isAlphabeticalSorted) {
                const sortLogic = (a, b) => a.name.localeCompare(b.name);
                favs.sort(sortLogic); others.sort(sortLogic);
            }

            logicalMasterList = [...favs, ...others];
            let anchorStation = null;
            let visualList = [...logicalMasterList];

            if (currentStationId !== null) {
                const index = visualList.findIndex(s => s.id === currentStationId);
                if (index > -1) [anchorStation] = visualList.splice(index, 1);
            }

            const activeDisplayList = anchorStation ? [anchorStation, ...visualList] : visualList;

            activeDisplayList.forEach((station) => {
                const tile = document.createElement('div');
                tile.className = `tile c${(station.id % 8) + 1}`;
                if (favoriteIds.includes(station.id)) tile.classList.add('is-fav');
                if (bufferingStationId === station.id) tile.classList.add('buffering');
                else if (errorStationId === station.id) tile.classList.add('error');
                else if (currentStationId === station.id) {
                    tile.classList.add(isActuallyPlaying ? 'active' : 'ready');
                    if (!isActuallyPlaying) playPauseBtn.disabled = false;
                }
                
                tile.dataset.id = station.id;
                const flagMatch = station.geo.match(/[\u{1F1E6}-\u{1F1FF}]{2}/u);
                const flagEmoji = flagMatch ? flagMatch[0] : "";
                const stateText = station.geo.replace(flagEmoji, "").trim();

                tile.innerHTML = `
                    <div class="fav-star">â˜…</div>
                    <div class="status-container">
                        <div class="spinner"></div>
                        <svg class="error-icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                        <svg class="tile-play-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                        <div class="eq-container">
                            <div class="eq-bar"></div><div class="eq-bar"></div><div class="eq-bar"></div><div class="eq-bar"></div>
                        </div>
                    </div>
                    <div class="tile-info-stack">
                        <div class="tile-main-genre">${station.genre}</div>
                        <div class="tile-name">${station.name}</div>
                    </div>
                    <div class="geo-tag">
                        <span class="geo-text">${stateText}</span>
                        <span class="geo-flag">${flagEmoji}</span>
                    </div>
                `;
                tile.querySelector('.fav-star').onclick = (e) => { e.stopPropagation(); toggleFavorite(station.id); };
                tile.onclick = () => handleTileClick(station.id);
                grid.appendChild(tile);
            });
        }

        timerBtn.onclick = () => {
            if (currentTimerDuration === 0) startSleepTimer(30);
            else if (currentTimerDuration === 30) startSleepTimer(15);
            else clearSleepTimer();
        };

        function startSleepTimer(minutes) {
            if (sleepTimerTimeout) clearTimeout(sleepTimerTimeout);
            if (sleepTickInterval) clearInterval(sleepTickInterval);
            timerBtn.classList.remove('active'); void timerBtn.offsetWidth; timerBtn.classList.add('active');
            currentTimerDuration = minutes;
            timerIcon.style.display = 'none'; timerDisplay.style.display = 'block'; timerDisplay.innerText = currentTimerDuration;
            let remaining = minutes;
            sleepTickInterval = setInterval(() => {
                remaining--;
                if (remaining <= 0) { stopPlayback(); clearSleepTimer(); } else timerDisplay.innerText = remaining;
            }, 60000);
            sleepTimerTimeout = setTimeout(() => { stopPlayback(); clearSleepTimer(); }, minutes * 60000);
        }

        function clearSleepTimer() {
            if (sleepTimerTimeout) clearTimeout(sleepTimerTimeout);
            if (sleepTickInterval) clearInterval(sleepTickInterval);
            sleepTimerTimeout = null; sleepTickInterval = null; currentTimerDuration = 0;
            timerBtn.classList.remove('active'); timerIcon.style.display = 'block'; timerDisplay.style.display = 'none';
        }

        function toggleFavorite(id) {
            if (favoriteIds.includes(id)) favoriteIds = favoriteIds.filter(fid => fid !== id);
            else favoriteIds.push(id);
            localStorage.setItem('favStations', JSON.stringify(favoriteIds)); renderGrid();
        }

        function handleTileClick(id) {
            if (currentStationId === id && isActuallyPlaying) stopPlayback();
            else playStation(id);
        }

        function setupMediaHandlers() {
            if ('mediaSession' in navigator) {
                navigator.mediaSession.setActionHandler('previoustrack', () => navigateStation(-1));
                navigator.mediaSession.setActionHandler('nexttrack', () => navigateStation(1));
                navigator.mediaSession.setActionHandler('play', () => { if (currentStationId !== null) playStation(currentStationId); });
                navigator.mediaSession.setActionHandler('pause', () => stopPlayback());
            }
        }

        function navigateStation(direction) {
            const currentIndex = logicalMasterList.findIndex(s => s.id === currentStationId);
            const nextIndex = (currentIndex + direction + logicalMasterList.length) % logicalMasterList.length;
            playStation(logicalMasterList[nextIndex].id);
        }

        function updateMediaMetadata(station) {
            if ('mediaSession' in navigator) {
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: station.name, artist: station.genre, album: station.geo,
                    artwork: [{ src: 'image_0.png.jpg', sizes: '512x512', type: 'image/png' }]
                });
                navigator.mediaSession.playbackState = "playing"; setupMediaHandlers(); 
            }
            document.title = `${station.name} - Radio`;
        }

        function playStation(id) {
            const station = stations.find(s => s.id === id);
            errorStationId = null; bufferingStationId = id; isActuallyPlaying = false; renderGrid();
            player.src = station.url;
            player.play().then(() => {
                bufferingStationId = null; currentStationId = id; isActuallyPlaying = true;
                localStorage.setItem('lastStationId', id); playPauseBtn.disabled = false;
                updatePlayPauseButton(true); renderGrid(); scrollContainer.scrollTo({top: 0, behavior: 'smooth'});
                updateMediaMetadata(station);
            }).catch(e => { bufferingStationId = null; errorStationId = id; renderGrid(); });
        }

        player.onerror = () => { if (bufferingStationId !== null) { errorStationId = bufferingStationId; bufferingStationId = null; renderGrid(); } };

        function stopPlayback() {
            player.pause(); isActuallyPlaying = false;
            if ('mediaSession' in navigator) navigator.mediaSession.playbackState = "paused";
            updatePlayPauseButton(false); renderGrid(); document.title = "Radio";
        }

        function updatePlayPauseButton(playing) { playPauseIcon.innerHTML = `<path d="${playing ? stopPath : playPath}"/>`; }

        let touchstartX = 0; let touchendX = 0;
        document.addEventListener('touchstart', e => { touchstartX = e.changedTouches[0].screenX; }, {passive: true});
        document.addEventListener('touchend', e => {
            touchendX = e.changedTouches[0].screenX; const diff = touchstartX - touchendX;
            if (Math.abs(diff) > 100) { if (diff > 0) navigateStation(1); else navigateStation(-1); }
        }, {passive: true});

        sortBtn.onclick = () => { 
            isAlphabeticalSorted = !isAlphabeticalSorted; 
            if (isAlphabeticalSorted) sortBtn.classList.add('active'); else sortBtn.classList.remove('active');
            renderGrid(); 
        };

        shuffleBtn.onclick = () => { 
            if (logicalMasterList.length > 0) {
                const randomIndex = Math.floor(Math.random() * logicalMasterList.length); 
                playStation(logicalMasterList[randomIndex].id); 
            }
        };

        playPauseBtn.onclick = () => { if (isActuallyPlaying) stopPlayback(); else if (currentStationId !== null) playStation(currentStationId); };

        renderGrid(); setupMediaHandlers();
        document.addEventListener('touchmove', function (e) { 
            if (e.target.closest('#scroll-container') || e.target.closest('#dropdown-menu')) return; 
            e.preventDefault(); 
        }, { passive: false });
    </script>
</body>
</html>
